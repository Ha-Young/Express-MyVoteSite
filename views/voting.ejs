<!DOCTYPE html>
<html>
  <head>
    <% include ./partials/head %>
  </head>
  <body>
    <% include ./partials/header %>
    <%if (flashes) { %>
      <p><%= flashes.error %></p>
    <% } %>
    <div class='top-banner'>
      <i class='fas fa-check fa-3x'></i>
      <% if (voting.isOpen) { %>
        <h3>투표하세요!</h3>
      <% } else { %>
        <h3>필요한 답을 얻으세요!</h3>
      <% } %>
    </div>
    <div class='voting-wrap single-details content'>
      <% if (voting.isOpen) { %>
        <form action='/votings/<%= voting._id %>?_method=PUT' method='POST' class='voting-form'>
          <h2><%= voting.title %></h2>
          <p class='info'>
            <span class='status'><%= voting.isOpen ? '진행중':'종료' %></span>
            <span class='expiration'><%= voting.expiration %></span>
            <span class='author'><%= voting.author %></span>
          </p>
          <ul class='options'>
            <% for (var i = 0; i < voting.options.length; i++) {%>
              <li>
                <input
                  type='radio'
                  name='option'
                  id='option<%= i %>'
                  value=<%= voting.options[i]._id %>
                  <%= votedIndex === i ? 'checked' : '' %>
                  <%= isVoted ? 'disabled' : '' %>
                >
                <label for='option<%= i %>'><%= voting.options[i].text %></label>
              </li>
            <% } %>
          </ul>
          <% if (!isVoted) { %>
            <input type='submit' class='submit-button' value='Submit'>
          <% } %>
        </form>
      <% } %>
      <p></p>
      <% if (!voting.isOpen || voting.isAuthor) { %>
        <div  class='result'>
          <h2><%= voting.title %></h2>
          <p class='info'>
            <span class='status'><%= voting.isOpen ? '진행중':'종료' %></span>
            <span class='expiration'><%= voting.expiration %></span>
            <span class='author'><%= voting.author %></span>
          </p>
          <p>총 투표자 수: <%= totalVotes %></p>
          <ul>
            <% for (let i = 0; i < voting.options.length; i++) { %>
              <li>
                <span><%= voting.options[i].text %></span>
                <span><%= voting.options[i].selected_user.length %></span>
            <% } %>
          </ul>
        </div>
      <% } %>
      <% if (voting.isAuthor) { %>
        <form action='/votings/<%= voting._id %>?_method=DELETE' method='POST'>
          <input type='submit' class='submit-button' value='Delete'>
        </form>
      <% } %>
    </div>
  </body>
</html>
