<% include partials/header %>

<div class="poll-container">

  <p>Title: <%= pollDoc.title %>
    <% if (isOwner) { %>
    <p>Wanna Delete this Poll? Click -> <i id="delete-poll-button" class="far fa-trash-alt"></i></p>
    <p> You're the owner of this poll! you should be able to view the current process this poll</p>
    <% } %>
  </p>
  <p>Status: <%= pollDoc.isOpen ? 'Open' : 'Closed' %></p>
  <p>Author: <%= pollDoc.authorname %></p>
  <p>Expiry Date:
    <%= pollDoc.expirydate %></p>
  <div class="poll-options-container">
    <form id="vote-form" name="vote-form" action="" method="POST">
      <% pollDoc.options.forEach(function(option) { %>
      <label for="<%= option.name %>"><%= option.name %></label>
      <% if (isOwner || !pollDoc.isOpen  ) { %>
      <span>Count: <%= option.count %></span>
      <% } %>
      <% if (hasVoted < 0 && pollDoc.isOpen) { %>
      <input type="radio" name="optionID" id="<%= option.name %>" value="<%= option._id %>">
      <% } %>
      <br>
      <% }) %>
      <% if (hasVoted < 0 && pollDoc.isOpen) { %>
      <input type="submit" value="Submit">
      <% } %>
      <% if (hasVoted >= 0) { %>
      <p>You have already voted for this poll</p>
      <% } %>
    </form>
  </div>

  <script>
    const deletePollButton = document.querySelector('#delete-poll-button');
    deletePollButton.addEventListener('click', deletePoll);

    const voteForm = document.querySelector('#vote-form');
    voteForm.setAttribute('action', window.location.pathname);

    function deletePoll() {
      const params = window.location.pathname;
      fetch(params, {
        method: 'DELETE'
      })
        .then((response) => {
          if (response.ok) {
            alert('poll deleted. will now redirect to homepage')
            window.location.href = 'http://localhost:5000/'
          }
        })
        .catch((error) => {
          console.log(error);
        });
    }
  </script>
</div>
